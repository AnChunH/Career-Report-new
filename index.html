<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>生涯規劃報告</title>
    <script src="https://cdn.tailwindcss.com">
function downloadReportAsTXT() {
    let content = "【生涯規劃報告填寫結果】\n\n";
    const elements = document.querySelectorAll("input, textarea, select");
    elements.forEach(el => {
        if (!el.name && !el.id) return;

        const label = el.closest("div")?.querySelector("label")?.innerText || el.name || el.id;
        let value = "";

        if (el.type === "radio" || el.type === "checkbox") {
            if (el.checked) {
                value = el.value;
            } else {
                return;
            }
        } else if (el.tagName === "SELECT" && el.multiple) {
            value = Array.from(el.selectedOptions).map(opt => opt.value).join(", ");
        } else {
            value = el.value;
        }

        if (value) {
            content += `【${label}】\n${value}\n\n`;
        }
    });

    const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "生涯規劃報告.txt";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
}

</script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* 自定義滾動條樣式 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        /* 設置全局字體為 Inter */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* 自定義 Tailwind 顏色 */
        .bg-gradient-to-r-custom {
            background-image: linear-gradient(to right, #6a11cb 0%, #2575fc 100%);
        }
        .text-gradient-custom {
            background: linear-gradient(to right, #6a11cb, #2575fc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        /* 隱藏預設的 radio/checkbox 樣式 */
        input[type="radio"],
        input[type="checkbox"] {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            display: inline-block;
            width: 1.25rem; /* w-5 */
            height: 1.25rem; /* h-5 */
            border-radius: 0.375rem; /* rounded-md */
            border: 2px solid #cbd5e0; /* border-gray-300 */
            vertical-align: middle;
            position: relative;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }

        input[type="radio"]:checked {
            background-color: #2575fc; /* blue-600 */
            border-color: #2575fc; /* blue-600 */
        }
        input[type="radio"]:checked::before {
            content: '';
            display: block;
            width: 0.5rem; /* w-2 */
            height: 0.5rem; /* h-2 */
            background-color: #ffffff; /* white */
            border-radius: 9999px; /* rounded-full */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        input[type="checkbox"]:checked {
            background-color: #2575fc; /* blue-600 */
            border-color: #2575fc; /* blue-600 */
        }
        input[type="checkbox"]:checked::before {
            content: '✔'; /* Checkmark symbol */
            display: block;
            color: #ffffff; /* white */
            font-size: 0.75rem; /* text-xs */
            line-height: 1;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 p-4 sm:p-6 lg:p-8">

    <header class="mb-8 text-center">
        <h1 class="text-4xl sm:text-5xl lg:text-6xl font-extrabold mb-2 text-gradient-custom">
            生涯規劃報告
        </h1>
        <p class="text-lg sm:text-xl text-gray-600">從回顧到展望:我們的學習與未來</p>
        <p class="text-sm sm:text-base text-gray-500 mt-2">
            這份報告不是交差用的作業,而是幫你自己整理腳步、預備下一步的工具
        </p>
    </header>

    <section class="mb-8 p-6 bg-blue-100 rounded-lg border border-blue-300 text-center shadow-md">
        <h2 class="text-2xl sm:text-3xl font-bold mb-4 text-blue-900">
            給高一升高二的你：啟程，探索未來的無限可能！
        </h2>
        <p class="text-lg text-gray-700 leading-relaxed">
            恭喜你即將邁入高中生涯的下一個階段！高二是一個關鍵的時期，你將有更多機會深入探索自己的興趣與潛能。這份生涯規劃報告，正是為你量身打造的工具，幫助你回顧過去的學習歷程，釐清現在的優勢與不足，並展望未來，為你的升學與職涯道路奠定堅實的基礎。
        </p>
        <p class="text-lg text-gray-700 leading-relaxed mt-2">
            讓我們一起透過這份報告，更了解自己，勇敢地規劃屬於你的精彩未來吧！
        </p>
    </section>

    <main class="max-w-4xl mx-auto bg-white p-6 sm:p-8 rounded-xl shadow-lg border border-gray-200">

        <section class="mb-8 p-6 bg-blue-50 rounded-lg border border-blue-200">
            <h2 class="text-2xl sm:text-3xl font-bold mb-4 text-blue-800">一、個人資訊與學習反思</h2>
            <div class="space-y-4">
                <div>
                    <label for="name" class="block text-gray-700 font-medium mb-1">姓名:</label>
                    <input type="text" id="name" name="name" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="請輸入您的姓名">
                </div>
                <div>
                    <label for="learnerType" class="block text-gray-700 font-medium mb-2">你覺得自己是哪種類型的學習者？</label>
                    <select id="learnerType" name="learnerType" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" onchange="updatePrompts()">
                        <option value="">請選擇</option>
                        <option value="成績優異型">成績優異型</option>
                        <option value="穩定中等型">穩定中等型</option>
                        <option value="多元興趣型">多元興趣型</option>
                        <option value="實作學習型">實作學習型</option>
                        <option value="創作思考型">創作思考型</option>
                        <option value="尚未明確型">尚未明確型</option>
                    </select>
                    <div id="promptTips" class="mt-2 p-3 bg-blue-50 border border-blue-200 rounded-md text-sm text-blue-700 italic">
                        選擇你的學習者類型，這裡會給你一些撰寫提示喔！
                    </div>
                </div>
                <div>
                    <label for="goal_effort" class="block text-gray-700 font-medium mb-1">你曾為什麼目標主動投入時間與努力?</label>
                    <textarea id="goal_effort" name="goal_effort" rows="3" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="請描述您的目標與努力過程"></textarea>
                </div>
                <div>
                    <label for="achievement" class="block text-gray-700 font-medium mb-1">你最有成就感的一件事(學習)是什麼?</label>
                    <textarea id="achievement" name="achievement" rows="3" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="請描述您的成就感經驗"></textarea>
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-2">你覺得自己現在比較適合哪一類的學習方式?</label>
                    <div class="flex flex-wrap gap-4">
                        <label class="inline-flex items-center">
                            <input type="radio" name="learning_style" value="理論" class="form-radio text-blue-600">
                            <span class="ml-2 text-gray-700">理論</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="learning_style" value="實作" class="form-radio text-blue-600">
                            <span class="ml-2 text-gray-700">實作</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" name="learning_style" value="創作" class="form-radio text-blue-600">
                            <span class="ml-2 text-gray-700">創作</span>
                        </label>
                    </div>
                </div>
                <div>
                    <label for="evidence" class="block text-gray-700 font-medium mb-1">我曾經為一個目標努力過的證據是什麼?</label>
                    <textarea id="evidence" name="evidence" rows="3" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="例如: 筆記、影片、照片、心得、比賽、專題、閱讀等"></textarea>
                </div>
                <div>
                    <label for="suitable_field" class="block text-gray-700 font-medium mb-1">哪一個經驗讓我覺得我可能適合某個領域?</label>
                    <textarea id="suitable_field" name="suitable_field" rows="3" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="請描述您的經驗"></textarea>
                </div>
            </div>
        </section>

        <section class="mb-8 p-6 bg-green-50 rounded-lg border border-green-200">
            <h2 class="text-2xl sm:text-3xl font-bold mb-4 text-green-800">二、學習歷程盤點與回顧</h2>

            <div class="mb-6 p-4 bg-white rounded-lg shadow-sm border border-gray-200">
                <h3 class="text-xl sm:text-2xl font-semibold mb-3 text-gray-700 cursor-pointer flex justify-between items-center" onclick="toggleSection('academic_learning_content')">
                    學科學習 <span class="text-gray-500 text-sm">(點擊展開/收合)</span>
                </h3>
                <div id="academic_learning_content" class="space-y-4 hidden">
                    <div>
                        <label for="academic_achievements" class="block text-gray-700 font-medium mb-1">目前成果:</label>
                        <textarea id="academic_achievements" name="academic_achievements" rows="2" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="例: 參加學科競賽、段考成績優良、修習額外課程"></textarea>
                    </div>
                    <div>
                        <label for="academic_process" class="block text-gray-700 font-medium mb-1">學習歷程:</label>
                        <textarea id="academic_process" name="academic_process" rows="2" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="例: 學習筆記、課程筆記"></textarea>
                    </div>
                    <div>
                        <label for="academic_improvement" class="block text-gray-700 font-medium mb-1">補強計畫:</label>
                        <textarea id="academic_improvement" name="academic_improvement" rows="2" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="例: 準備物理競賽、補強英文表達、修習新課程"></textarea>
                    </div>
                    <div>
                        <label for="academic_cluster" class="block text-gray-700 font-medium mb-1">對應學群(ColleGo!):</label>
                        <select id="academic_cluster" name="academic_cluster" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200">
                            <option value="">請選擇學群</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="mb-6 p-4 bg-white rounded-lg shadow-sm border border-gray-200">
                <h3 class="text-xl sm:text-2xl font-semibold mb-3 text-gray-700 cursor-pointer flex justify-between items-center" onclick="toggleSection('interdisciplinary_learning_content')">
                    跨領域學習 <span class="text-gray-500 text-sm">(點擊展開/收合)</span>
                </h3>
                <div id="interdisciplinary_learning_content" class="space-y-4 hidden">
                    <div>
                        <label for="interdisciplinary_achievements" class="block text-gray-700 font-medium mb-1">目前成果:</label>
                        <textarea id="interdisciplinary_achievements" name="interdisciplinary_achievements" rows="2" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="例: 科普講座、跨域專題、AI體驗營"></textarea>
                    </div>
                    <div>
                        <label for="interdisciplinary_process" class="block text-gray-700 font-medium mb-1">學習歷程:</label>
                        <textarea id="interdisciplinary_process" name="interdisciplinary_process" rows="2" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="請描述您的紀錄與心得"></textarea>
                    </div>
                    <div>
                        <label for="interdisciplinary_improvement" class="block text-gray-700 font-medium mb-1">補強計畫:</label>
                        <textarea id="interdisciplinary_improvement" name="interdisciplinary_improvement" rows="2" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="想嘗試的跨域學習是?"></textarea>
                    </div>
                    <div>
                        <label for="interdisciplinary_cluster" class="block text-gray-700 font-medium mb-1">對應學群(ColleGo!):</label>
                        <select id="interdisciplinary_cluster" name="interdisciplinary_cluster" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200">
                            <option value="">請選擇學群</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="mb-6 p-4 bg-white rounded-lg shadow-sm border border-gray-200">
                <h3 class="text-xl sm:text-2xl font-semibold mb-3 text-gray-700 cursor-pointer flex justify-between items-center" onclick="toggleSection('competition_content')">
                    學科競賽 <span class="text-gray-500 text-sm">(點擊展開/收合)</span>
                </h3>
                <div id="competition_content" class="space-y-4 hidden">
                    <div>
                        <label for="competition_achievements" class="block text-gray-700 font-medium mb-1">目前成果:</label>
                        <textarea id="competition_achievements" name="competition_achievements" rows="2" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="例: 語文競賽、科展、數理競賽"></textarea>
                    </div>
                    <div>
                        <label for="competition_process" class="block text-gray-700 font-medium mb-1">學習歷程:</label>
                        <textarea id="competition_process" name="competition_process" rows="2" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="獲獎經驗與準備過程"></textarea>
                    </div>
                    <div>
                        <label for="competition_improvement" class="block text-gray-700 font-medium mb-1">補強計畫:</label>
                        <textarea id="competition_improvement" name="competition_improvement" rows="2" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="準備中的競賽或目標"></textarea>
                    </div>
                    <div>
                        <label for="competition_cluster" class="block text-gray-700 font-medium mb-1">對應學群(ColleGo!):</label>
                        <select id="competition_cluster" name="competition_cluster" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200">
                            <option value="">請選擇學群</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="mb-6 p-4 bg-white rounded-lg shadow-sm border border-gray-200">
                <h3 class="text-xl sm:text-2xl font-semibold mb-3 text-gray-700 cursor-pointer flex justify-between items-center" onclick="toggleSection('autonomous_learning_content')">
                    自主學習 <span class="text-gray-500 text-sm">(點擊展開/收合)</span>
                </h3>
                <div id="autonomous_learning_content" class="space-y-4 hidden">
                    <div>
                        <label for="autonomous_topic" class="block text-gray-700 font-medium mb-1">我的主題與成果:</label>
                        <textarea id="autonomous_topic" name="autonomous_topic" rows="2" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="例: 線上課程、撰寫小論文、寫研究報告"></textarea>
                    </div>
                    <div>
                        <label for="autonomous_process" class="block text-gray-700 font-medium mb-1">學習歷程:</label>
                        <textarea id="autonomous_process" name="autonomous_process" rows="2" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="我如何規劃與紀錄?"></textarea>
                    </div>
                    <div>
                        <label for="autonomous_improvement" class="block text-gray-700 font-medium mb-1">補強計畫:</label>
                        <textarea id="autonomous_improvement" name="autonomous_improvement" rows="2" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="想深化的主題或技巧是?"></textarea>
                    </div>
                    <div>
                        <label for="autonomous_cluster" class="block text-gray-700 font-medium mb-1">對應學群(ColleGo!):</label>
                        <select id="autonomous_cluster" name="autonomous_cluster" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200">
                            <option value="">請選擇學群</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="mb-6 p-4 bg-white rounded-lg shadow-sm border border-gray-200">
                <h3 class="text-xl sm:text-2xl font-semibold mb-3 text-gray-700 cursor-pointer flex justify-between items-center" onclick="toggleSection('lectures_forums_content')">
                    科學講座與論壇 <span class="text-gray-500 text-sm">(點擊展開/收合)</span>
                </h3>
                <div id="lectures_forums_content" class="space-y-4 hidden">
                    <div>
                        <label for="lectures_forums_activities" class="block text-gray-700 font-medium mb-1">我參與的活動:</label>
                        <textarea id="lectures_forums_activities" name="lectures_forums_activities" rows="2" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="例: 參與科普演講、學校講座、線上論壇"></textarea>
                    </div>
                    <div>
                        <label for="lectures_forums_reflection" class="block text-gray-700 font-medium mb-1">學習歷程與反思:</label>
                        <textarea id="lectures_forums_reflection" name="lectures_forums_reflection" rows="2" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="最印象深刻的觀點是?"></textarea>
                    </div>
                    <div>
                        <label for="lectures_forums_improvement" class="block text-gray-700 font-medium mb-1">補強計畫:</label>
                        <textarea id="lectures_forums_improvement" name="lectures_forums_improvement" rows="2" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="未來想聽哪方面的講座?"></textarea>
                    </div>
                    <div>
                        <label for="lectures_forums_cluster" class="block text-gray-700 font-medium mb-1">對應學群(ColleGo!):</label>
                        <select id="lectures_forums_cluster" name="lectures_forums_cluster" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200">
                            <option value="">請選擇學群</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="mb-6 p-4 bg-white rounded-lg shadow-sm border border-gray-200">
                <h3 class="text-xl sm:text-2xl font-semibold mb-3 text-gray-700 cursor-pointer flex justify-between items-center" onclick="toggleSection('volunteer_social_service_content')">
                    志工與社會服務 <span class="text-gray-500 text-sm">(點擊展開/收合)</span>
                </h3>
                <div id="volunteer_social_service_content" class="space-y-4 hidden">
                    <div>
                        <label for="volunteer_experience" class="block text-gray-700 font-medium mb-1">我的參與經驗:</label>
                        <textarea id="volunteer_experience" name="volunteer_experience" rows="2" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="例: 偏鄉服務、校內志工、環境清潔活動"></textarea>
                    </div>
                    <div>
                        <label for="volunteer_reflection" class="block text-gray-700 font-medium mb-1">反思與學習歷程:</label>
                        <textarea id="volunteer_reflection" name="volunteer_reflection" rows="2" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="這些經驗帶給我什麼學習與影響?"></textarea>
                    </div>
                    <div>
                        <label for="volunteer_improvement" class="block text-gray-700 font-medium mb-1">補強計畫:</label>
                        <textarea id="volunteer_improvement" name="volunteer_improvement" rows="2" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="想規劃或延續哪些服務?"></textarea>
                    </div>
                    <div>
                        <label for="volunteer_cluster" class="block text-gray-700 font-medium mb-1">對應學群(ColleGo!):</label>
                        <select id="volunteer_cluster" name="volunteer_cluster" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200">
                            <option value="">請選擇學群</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="mb-6 p-4 bg-white rounded-lg shadow-sm border border-gray-200">
                <h3 class="text-xl sm:text-2xl font-semibold mb-3 text-gray-700 cursor-pointer flex justify-between items-center" onclick="toggleSection('club_leadership_content')">
                    社團與領導活動 <span class="text-gray-500 text-sm">(點擊展開/收合)</span>
                </h3>
                <div id="club_leadership_content" class="space-y-4 hidden">
                    <div>
                        <label for="club_role" class="block text-gray-700 font-medium mb-1">我的角色與貢獻:</label>
                        <textarea id="club_role" name="club_role" rows="2" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="例: 班級幹部、社團幹部、活動主持、籌備營隊"></textarea>
                    </div>
                    <div>
                        <label for="club_leadership_process" class="block text-gray-700 font-medium mb-1">領導學習歷程:</label>
                        <textarea id="club_leadership_process" name="club_leadership_process" rows="2" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="最具挑戰的經驗與收穫?"></textarea>
                    </div>
                    <div>
                        <label for="club_leadership_improvement" class="block text-gray-700 font-medium mb-1">補強計畫:</label>
                        <textarea id="club_leadership_improvement" name="club_leadership_improvement" rows="2" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="想嘗試的新角色或能力是?"></textarea>
                    </div>
                    <div>
                        <label for="club_leadership_cluster" class="block text-gray-700 font-medium mb-1">對應學群(ColleGo!):</label>
                        <select id="club_leadership_cluster" name="club_leadership_cluster" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200">
                            <option value="">請選擇學群</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="mb-6 p-4 bg-white rounded-lg shadow-sm border border-gray-200">
                <h3 class="text-xl sm:text-2xl font-semibold mb-3 text-gray-700 cursor-pointer flex justify-between items-center" onclick="toggleSection('works_projects_content')">
                    作品與專題報告 <span class="text-gray-500 text-sm">(點擊展開/收合)</span>
                </h3>
                <div id="works_projects_content" class="space-y-4 hidden">
                    <div>
                        <label for="works_projects_content_area" class="block text-gray-700 font-medium mb-1">我的成果內容:</label>
                        <textarea id="works_projects_content_area" name="works_projects_content_area" rows="2" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="例: 發表創作、完成專題、參與科展"></textarea>
                    </div>
                    <div>
                        <label for="works_projects_process" class="block text-gray-700 font-medium mb-1">專題歷程與展示:</label>
                        <textarea id="works_projects_process" name="works_projects_process" rows="2" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="我如何規劃與呈現成果?"></textarea>
                    </div>
                    <div>
                        <label for="works_projects_improvement" class="block text-gray-700 font-medium mb-1">補強計畫:</label>
                        <textarea id="works_projects_improvement" name="works_projects_improvement" rows="2" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="下一個想探索的主題是?"></textarea>
                    </div>
                    <div>
                        <label for="works_projects_cluster" class="block text-gray-700 font-medium mb-1">對應學群(ColleGo!):</label>
                        <select id="works_projects_cluster" name="works_projects_cluster" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200">
                            <option value="">請選擇學群</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="mb-6 p-4 bg-white rounded-lg shadow-sm border border-gray-200">
                <h3 class="text-xl sm:text-2xl font-semibold mb-3 text-gray-700 cursor-pointer flex justify-between items-center" onclick="toggleSection('future_goals_content')">
                    未來學習目標 <span class="text-gray-500 text-sm">(點擊展開/收合)</span>
                </h3>
                <div id="future_goals_content" class="space-y-4 hidden">
                    <div>
                        <label for="future_interest_area" class="block text-gray-700 font-medium mb-1">目前興趣領域:</label>
                        <textarea id="future_interest_area" name="future_interest_area" rows="2" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="例: 生物醫學、機器學習、設計思維等"></textarea>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">目前歷程是否與興趣一致?</label>
                        <div class="flex flex-wrap gap-4">
                            <label class="inline-flex items-center">
                                <input type="radio" name="interest_consistent" value="是" class="form-radio text-blue-600">
                                <span class="ml-2 text-gray-700">是</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="interest_consistent" value="否" class="form-radio text-blue-600">
                                <span class="ml-2 text-gray-700">否</span>
                            </label>
                        </div>
                    </div>
                    <div>
                        <label for="future_improvement_needed" class="block text-gray-700 font-medium mb-1">需要補強的部分:</label>
                        <textarea id="future_improvement_needed" name="future_improvement_needed" rows="2" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="請描述需要加強的方面"></textarea>
                    </div>
                    <div>
                        <label for="future_plan" class="block text-gray-700 font-medium mb-1">下一步學習規劃:</label>
                        <textarea id="future_plan" name="future_plan" rows="2" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="我打算如何朝這個方向前進?"></textarea>
                    </div>
                    <div>
                        <label for="future_cluster" class="block text-gray-700 font-medium mb-1">對應學群(ColleGo!):</label>
                        <select id="future_cluster" name="future_cluster" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200">
                            <option value="">請選擇學群</option>
                        </select>
                    </div>
                </div>
            </div>
        </section>

        <section class="mb-8 p-6 bg-yellow-50 rounded-lg border border-yellow-200">
            <h2 class="text-2xl sm:text-3xl font-bold mb-4 text-yellow-800">三、高二的發展計畫</h2>
            <div class="space-y-4">
                <div>
                    <label for="sophomore_strengthen" class="block text-gray-700 font-medium mb-1">根據我的高一學習歷程,我認為需要加強的部分有:</label>
                    <textarea id="sophomore_strengthen" name="sophomore_strengthen" rows="3" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="請描述您需要加強的部分"></textarea>
                </div>
                <div>
                    <label for="sophomore_new_plan" class="block text-gray-700 font-medium mb-1">新增的自主學習與活動計畫:</label>
                    <textarea id="sophomore_new_plan" name="sophomore_new_plan" rows="3" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="請描述新增的計畫"></textarea>
                </div>
                <div>
                    <label for="sophomore_extracurricular" class="block text-gray-700 font-medium mb-1">預計參與的課外活動與計畫:</label>
                    <textarea id="sophomore_extracurricular" name="sophomore_extracurricular" rows="3" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="請描述預計參與的活動"></textarea>
                </div>
                <div>
                    <label class="block text-gray-700 font-medium mb-2">我希望在高二能夠達成的目標:</label>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        <label class="inline-flex items-center">
                            <input type="checkbox" name="sophomore_goals" value="加強學科競賽與研究" class="form-checkbox text-blue-600">
                            <span class="ml-2 text-gray-700">加強學科競賽與研究</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="checkbox" name="sophomore_goals" value="拓展跨領域學習與應用" class="form-checkbox text-blue-600">
                            <span class="ml-2 text-gray-700">拓展跨領域學習與應用</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="checkbox" name="sophomore_goals" value="投入更多志工服務與社會參與" class="form-checkbox text-blue-600">
                            <span class="ml-2 text-gray-700">投入更多志工服務與社會參與</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="checkbox" name="sophomore_goals" value="完整記錄學習歷程以備升學使用" class="form-checkbox text-blue-600">
                            <span class="ml-2 text-gray-700">完整記錄學習歷程以備升學使用</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="checkbox" name="sophomore_goals" value="其他" id="sophomore_goals_other_checkbox" class="form-checkbox text-blue-600">
                            <span class="ml-2 text-gray-700">其他:</span>
                        </label>
                        <textarea id="sophomore_goals_other_text" name="sophomore_goals_other_text" rows="1" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="請輸入其他目標 (若勾選)" disabled></textarea>
                    </div>
                </div>
            </div>
        </section>

        <section class="mb-8 p-6 bg-purple-50 rounded-lg border border-purple-200">
            <h2 class="text-2xl sm:text-3xl font-bold mb-4 text-purple-800">四、升學方向規劃</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-gray-700 font-medium mb-2">學群選擇:</label>
                    <div id="cluster_selection_checkboxes" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
                        </div>
                </div>
                <div>
                    <label for="future_departments" class="block text-gray-700 font-medium mb-1">未來可能選擇的科系:</label>
                    <textarea id="future_departments" name="future_departments" rows="3" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="請輸入您未來可能選擇的科系"></textarea>
                </div>
                <div>
                    <label for="department_enhancements" class="block text-gray-700 font-medium mb-1">申請這些科系所需的學習歷程補強項目:</label>
                    <textarea id="department_enhancements" name="department_enhancements" rows="3" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="請描述所需的補強項目"></textarea>
                </div>
            </div>
        </section>

        <section class="mb-8 p-6 bg-indigo-50 rounded-lg border border-indigo-200">
            <h2 class="text-2xl sm:text-3xl font-bold mb-4 text-indigo-800">五、✨ 職涯發展建議</h2>
            <p class="text-gray-700 mb-4">點擊下方按鈕，根據您填寫的興趣領域、學習規劃與學群選擇，獲取個人化的職涯發展建議。</p>
            <button id="generateCareerSuggestionsButton" class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:shadow-lg transform hover:scale-105 transition duration-300 ease-in-out focus:outline-none focus:ring-4 focus:ring-purple-300 w-full sm:w-auto">
                ✨ 產生職涯發展建議
            </button>
            <div id="careerSuggestionsOutput" class="mt-6 p-4 bg-indigo-100 border border-indigo-300 rounded-md text-gray-800 whitespace-pre-wrap min-h-[100px] flex items-center justify-center text-center text-gray-500 italic">
                點擊按鈕後，建議將顯示在此處...
            </div>
            <div id="loadingIndicator" class="hidden mt-4 text-center text-indigo-600 font-semibold">
                生成中，請稍候...
            </div>
        </section>

        <section class="mb-8 p-6 bg-red-50 rounded-lg border border-red-200">
            <h2 class="text-2xl sm:text-3xl font-bold mb-4 text-red-800">六、結語反思</h2>
            <div class="space-y-4">
                <div>
                    <label for="conclusion_reflection_1" class="block text-gray-700 font-medium mb-1">透過這份生涯規劃報告,我更加的...</label>
                    <textarea id="conclusion_reflection_1" name="conclusion_reflection_1" rows="3" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="請填寫您的反思"></textarea>
                </div>
                <div>
                    <label for="conclusion_reflection_2" class="block text-gray-700 font-medium mb-1">希望自己在高二能...</label>
                    <textarea id="conclusion_reflection_2" name="conclusion_reflection_2" rows="3" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-200" placeholder="請填寫您的期望"></textarea>
                </div>
            </div>
        </section>

        <div class="flex flex-col sm:flex-row justify-center gap-4 mt-8">
            <button id="saveButton" class="bg-gradient-to-r-custom text-white font-bold py-3 px-6 rounded-lg shadow-md hover:shadow-lg transform hover:scale-105 transition duration-300 ease-in-out focus:outline-none focus:ring-4 focus:ring-blue-300">
                儲存報告
            </button>
            <button id="loadButton" class="bg-gray-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:shadow-lg transform hover:scale-105 transition duration-300 ease-in-out focus:outline-none focus:ring-4 focus:ring-gray-300">
                載入報告
            </button>
            <button id="clearButton" class="bg-red-500 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:shadow-lg transform hover:scale-105 transition duration-300 ease-in-out focus:outline-none focus:ring-4 focus:ring-red-300">
                清除報告
            </button>
        </div>
        <div id="messageBox" class="hidden fixed bottom-4 right-4 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-xl text-lg font-semibold z-50 animate-bounce">
            <span id="messageText"></span>
        </div>
    
<section class="mb-12 p-6 bg-pink-50 rounded-lg border border-pink-200 text-center shadow-md">
    <h2 class="text-2xl sm:text-3xl font-bold mb-4 text-pink-800">📤 上傳報告檔案</h2>
    <p class="text-lg text-gray-700 mb-4">完成填寫後，請點選下方按鈕下載 TXT 檔，並將檔案上傳至 Google 表單：</p>
    <a href="https://docs.google.com/forms/d/e/1FAIpQLSeT22Tpc5QgLhBqsT1CiMqUQZ1IVzTpJetr1hOjd4GeqUl0Pg/viewform?usp=header" target="_blank"
       class="inline-block bg-gradient-to-r from-pink-500 to-red-500 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:shadow-lg transform hover:scale-105 transition duration-300 ease-in-out focus:outline-none focus:ring-4 focus:ring-pink-300">
       📥 前往上傳表單
    </a>
</section>


<section class="mb-12 p-6 bg-teal-50 rounded-lg border border-teal-200 text-center shadow-md">
    <h2 class="text-2xl sm:text-3xl font-bold mb-4 text-teal-800">📄 下載填寫結果</h2>
    <p class="text-lg text-gray-700 mb-4">點擊下方按鈕將你目前填寫的所有內容匯出為 TXT 檔案，方便上傳與備份。</p>
    <button onclick="downloadReportAsTXT()" class="bg-gradient-to-r from-teal-500 to-green-500 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:shadow-lg transform hover:scale-105 transition duration-300 ease-in-out focus:outline-none focus:ring-4 focus:ring-green-300">
        📥 下載 TXT 檔
    </button>
</section>

</main>

    <script type="module">
    // Firebase 配置 (如果未來要引入，目前暫時不需要此段，留作參考)
    // import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    // import { getAuth } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    // import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, addDoc, getDocs, ... } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // const firebaseConfig = { /* 您的 Firebase 配置 */ };
    // let app;
    // let db;
    // let auth;
    // app = initializeApp(firebaseConfig);
    // db = getFirestore(app);
    // auth = getAuth(app);
    
function downloadReportAsTXT() {
    let content = "【生涯規劃報告填寫結果】\n\n";
    const elements = document.querySelectorAll("input, textarea, select");
    elements.forEach(el => {
        if (!el.name && !el.id) return;

        const label = el.closest("div")?.querySelector("label")?.innerText || el.name || el.id;
        let value = "";

        if (el.type === "radio" || el.type === "checkbox") {
            if (el.checked) {
                value = el.value;
            } else {
                return;
            }
        } else if (el.tagName === "SELECT" && el.multiple) {
            value = Array.from(el.selectedOptions).map(opt => opt.value).join(", ");
        } else {
            value = el.value;
        }

        if (value) {
            content += `【${label}】\n${value}\n\n`;
        }
    });

    const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "生涯規劃報告.txt";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
}

</script>

    <script>
        // 學群資料，從 PDF 內容提取
        const academicClusters = [
            { name: "數理化學學群", description: "著重數學與自然科學原理,包含數學系、化學系、物理系、應數系等" },
            { name: "工程學群", description: "強調工程實作與應用,包含機械、電機、資工、土木、生醫工程等科系" },
            { name: "資訊學群", description: "探討電腦科學、資料處理與AI,包含資訊工程、資管、人工智慧等科系" },
            { name: "生物資源學群", description: "聚焦動植物、農業與環境,包含農藝系、動科系、生技系、森林系等" },
            { name: "生命科學學群", description: "深入研究生命本質,包含生科系、生醫系、生化系、基因體科學等" },
            { name: "醫藥衛生學群", description: "涉及醫學、藥學、護理與公共衛生,包含醫學系、藥學系、牙醫、護理等" },
            { name: "地球與環境學群", description: "探討地球系統與永續發展,包含地科系、環境工程、海洋系等" },
            { name: "設計學群", description: "著重創意與視覺傳達,包含工設系、視傳系、建築設計、時尚設計等" },
            { name: "藝術學群", description: "涉及藝術創作與表演,包含美術系、音樂系、戲劇系、舞蹈系等" },
            { name: "社會與心理學群", description: "探究人類行為與社會運作,包含社會學、心理學、人類學、社工等" },
            { name: "人文社會學群", description: "探討歷史、哲學、語文等人文科目,包含中文、歷史、哲學、外文等" },
            { name: "法政學群", description: "涉及法律、政治與公共行政,包含法律系、政治系、外交系等" },
            { name: "財經管理學群", description: "著重經濟運作與企業管理,包含會計、財金、企管、國貿、行銷等" },
            { name: "教育學群", description: "聚焦教學與師資養成,包含教育系、幼教系、特殊教育等" },
            { name: "其他學群", description: "不在上述分類中,如體育學群、軍警學群、語言學群等" }
        ];

        // 智能引導的提示內容 (擴展到各個區塊)
        const guidanceDetails = {
            "成績優異型": {
                general: "你的成績證明了你的基礎紮實，在高二可以考慮挑戰更高難度的專題或競賽，並開始思考如何將學術優勢與未來志向結合。",
                personalInfo: {
                    goal_effort: "請具體描述你為學術目標（如某科考高分、解出難題）投入時間與努力的過程。",
                    achievement: "分享你在學術上最有成就感的一件事，例如在某個難題或專案中取得突破。",
                    evidence: "提供你為學術目標努力的具體證據，如高分考卷、論文草稿、研究筆記等。",
                    suitable_field: "描述某個學術經驗如何讓你覺得適合特定學術領域，例如數學解題讓你覺得適合工程。"
                },
                learningInventory: {
                    academic_achievements: "請具體描述你在學科上的卓越表現，例如競賽名次、特殊研究、高分科目等。",
                    academic_process: "詳細說明你在學科學習上的方法和策略，例如如何做筆記、預習復習等。",
                    academic_improvement: "即使成績好，也思考哪些學科知識或學習技巧可以進一步深化或挑戰高難度內容。",
                    autonomous_topic: "考慮選擇高難度或跨學科的主題，展現你的深度學習能力。",
                    autonomous_process: "描述你如何有系統地規劃與執行自主學習，並達成預設目標。",
                    autonomous_improvement: "想深化的主題或技巧是？思考如何將自主學習與學術優勢結合，例如自學高階程式語言。",
                    works_projects_content_area: "可以專注於將學科知識應用到專題或研究報告中，展現你的解決問題能力。",
                    works_projects_process: "說明你如何將學術成果轉化為具體的作品或報告，並思考如何更有效地展示。",
                    works_projects_improvement: "下一個想探索的主題是？思考如何將現有作品提升到更高學術水準。"
                },
                sophomorePlan: {
                    sophomore_strengthen: "即使成績好，也想想哪些非學術能力（如溝通、領導）可以加強，或在學術上進一步挑戰的領域？",
                    sophomore_new_plan: "考慮挑戰課外研究專案、國際交流或領導職位，進一步拓展你的視野與學術應用。",
                    sophomore_extracurricular: "預計參與哪些能加深學術能力或拓寬視野的課外活動，例如科研社、辯論社等。"
                },
                universityPlan: {
                    future_departments: "列出你最感興趣的頂尖大學及相關科系，考慮雙主修或輔系以擴展專業。",
                    department_enhancements: "思考如何透過額外的研究、實習或專案來凸顯你在申請頂尖科系上的優勢。",
                },
                conclusion: {
                    conclusion_reflection_1: "強調你如何從優異成績中學習到堅持與自律，並對未來充滿信心與期待。",
                    conclusion_reflection_2: "期望在高二能持續挑戰自我，在學術上更上一層樓，並將所學應用於實際問題，發展更全面的能力。"
                }
            },
            "穩定中等型": {
                general: "你具備穩定的學習能力，可以試著在高二發掘更多元興趣，透過社團、自主學習或跨領域課程，找到讓你眼睛發亮的領域。",
                personalInfo: {
                    goal_effort: "想想你曾為哪個具體目標（無論大小）付出過努力？即使是微小的進步也值得記錄。",
                    achievement: "回顧在學習中，哪一件事讓你感到有收穫或進步，即使不是最頂尖的表現。",
                    evidence: "找出能證明你努力過的痕跡，例如你整理過的筆記、參與活動的照片、練習紀錄等。",
                    suitable_field: "思考在哪些學習或活動經驗中，你感到特別投入或有興趣，這可能是適合你的領域線索。"
                },
                learningInventory: {
                    academic_achievements: "描述你在學科學習中，哪個部分讓你感到有進步或有收穫，例如從不及格到及格，或某科的學習方法有突破。",
                    academic_process: "說明你在學科學習中如何克服困難，找到適合自己的學習方法，例如透過重複練習、尋求老師協助等。",
                    academic_improvement: "找出你最有興趣或認為最需要補強的學科，規劃具體的學習計畫。",
                    interdisciplinary_achievements: "參加過哪些跨領域的活動（如講座、營隊），即使只是聽眾或體驗者，也值得記錄。",
                    interdisciplinary_process: "描述你參與跨領域活動後的心得與啟發，以及如何將不同領域的知識連結起來。",
                    interdisciplinary_improvement: "思考未來想嘗試哪些不同領域的課程或活動，以拓寬視野。",
                    autonomous_topic: "選擇你真正感興趣、想深入了解的主題，從小處著手，例如看完一本經典好書、學會一個基本技能。",
                    autonomous_process: "描述你如何規劃自主學習的步驟，例如查資料、做筆記、定期反思等。",
                    autonomous_improvement: "想深化的主題或技巧是？例如學習基礎的程式語言，或深入了解某個社會議題。",
                    club_role: "你在社團或班級中扮演了什麼角色？即使是小組成員，也描述你的參與和貢獻。",
                    club_leadership_process: "你在社團活動中是否有學到與人合作、解決問題的能力？請描述具體事例。",
                    club_leadership_improvement: "思考在高二想嘗試在社團或班級中扮演更積極的角色，例如擔任活動負責人。",
                },
                sophomorePlan: {
                    sophomore_strengthen: "根據高一的學習，找出需要加強的基礎科目或技能，並規劃具體提升方式。",
                    sophomore_new_plan: "規劃一些能幫助你探索興趣的自主學習或活動，例如閱讀特定領域書籍、參加體驗營。",
                    sophomore_extracurricular: "考慮參與一兩個你感興趣的社團或志工活動，拓展人際關係和課外經驗。",
                },
                universityPlan: {
                    future_departments: "列出你目前有興趣的科系類型，不需要完全確定，可以多方探索。",
                    department_enhancements: "思考這些科系看重哪些特質，你如何在學習歷程中補強這些特質。",
                },
                conclusion: {
                    conclusion_reflection_1: "反思你透過這份報告，如何更清楚自己的興趣所在，以及未來可以努力的方向。",
                    conclusion_reflection_2: "期望在高二能勇敢嘗試新事物，找到自己真正的熱情，並逐步建立自信。"
                }
            },
            "多元興趣型": {
                general: "你的興趣廣泛是寶貴資產，高二可以開始思考如何將這些興趣進行整合，找到彼此的連結，並在其中深化一兩個最有潛力的方向。",
                personalInfo: {
                    goal_effort: "請描述你為不同興趣目標投入時間與努力的經驗，並思考這些經驗的共通點。",
                    achievement: "分享在不同領域中讓你感到有成就感的事，並嘗試找出這些成就感來源的模式。",
                    evidence: "展示你多樣興趣的具體證明，如不同領域的筆記、作品、參與證明等。",
                    suitable_field: "思考在哪些跨領域或多重經驗中，你感到特別的連結或啟發，這可能指向你的整合能力。"
                },
                learningInventory: {
                    interdisciplinary_achievements: "具體描述你參與的跨領域活動，並強調不同領域知識如何在你身上產生連結。",
                    interdisciplinary_process: "說明你如何將不同領域的學習經驗進行整合與反思，例如從音樂中獲得的靈感應用到寫作。",
                    interdisciplinary_improvement: "思考如何將現有興趣進行更深度的整合，例如結合藝術與科技，或環境與社會。",
                    autonomous_topic: "嘗試選擇一個能結合你多個興趣點的主題進行自主學習，展現你的整合能力。",
                    autonomous_process: "描述你如何透過自主學習，將多個興趣領域的知識系統化或產出具體成果。",
                    autonomous_improvement: "想深化的主題或技巧是？思考如何將不同興趣點連結成一個獨特的學習路徑。",
                    club_role: "你在不同社團或活動中扮演了哪些角色？說明這些角色如何讓你發展多面向能力。",
                    club_leadership_process: "描述你在跨社團或跨活動合作中的經驗，以及如何協調不同興趣背景的成員。",
                    club_leadership_improvement: "思考如何在高二擔任更具整合性或協調性的角色，例如跨社團聯盟幹部。",
                    works_projects_content_area: "展示你橫跨多個領域的作品，例如結合程式設計與藝術的創作，或文學與科學的探討。",
                    works_projects_process: "說明你如何將不同領域的知識和技能融合到一個作品中，展現你的跨域整合能力。",
                    works_projects_improvement: "下一個想探索的主題是？思考如何將更多元的興趣融入到未來的專題或作品中。"
                },
                sophomorePlan: {
                    sophomore_strengthen: "思考哪些能力可以幫助你更好地整合多樣的興趣，例如專案管理、研究方法等。",
                    sophomore_new_plan: "規劃一個能結合你多個興趣的自主學習或專案，例如創立一個跨領域的讀書會。",
                    sophomore_extracurricular: "參與能夠同時滿足你多個興趣的活動，或嘗試創辦新的跨領域社團。",
                },
                universityPlan: {
                    future_departments: "探索跨領域學程、雙主修或輔系的科系，列出能讓你同時發展多重興趣的選項。",
                    department_enhancements: "思考如何凸顯你多樣的興趣和整合能力，例如透過跨領域專題或綜合性競賽來強化學習歷程。",
                },
                conclusion: {
                    conclusion_reflection_1: "反思你如何透過報告，更清楚地看到自己多樣興趣的價值和潛力，並找到整合這些興趣的路徑。",
                    conclusion_reflection_2: "期望在高二能深化並整合至少一到兩個最有潛力的興趣方向，並從中找到未來發展的突破口。"
                }
            },
            "實作學習型": {
                general: "動手做是你的優勢！高二可以積極參與實驗課、專題製作、科學營隊或工藝設計等活動，讓你的實作能力在學習歷程中更具體呈現。",
                personalInfo: {
                    goal_effort: "描述你為完成一個實作專案或解決實際問題所付出的努力和過程。",
                    achievement: "分享你在動手操作、解決實際問題或完成一個具體作品時最有成就感的一件事。",
                    evidence: "提供你實作能力的具體證據，如專題作品照片、實驗報告、設計圖、程式碼截圖等。",
                    suitable_field: "思考哪個實作經驗讓你覺得特別投入和有興趣，這可能是適合你未來發展的領域。"
                },
                learningInventory: {
                    academic_achievements: "在學科學習中，是否有透過實驗、實作專題或模型建立來加深理解的經驗？請具體描述。",
                    academic_process: "說明你如何透過動手實作、實驗操作來學習和驗證學科知識，例如製作物理實驗裝置。",
                    academic_improvement: "在學科學習中，哪些部分可以透過實作來補強或深化？例如參與實驗班或科展。",
                    interdisciplinary_achievements: "參與過哪些強調實作的跨領域活動，例如機器人營隊、程式設計工作坊等。",
                    interdisciplinary_process: "描述你在跨領域實作活動中的具體操作過程和學習收穫，例如如何完成一個跨域專案。",
                    interdisciplinary_improvement: "思考未來想嘗試哪些結合實作的跨領域學習，例如智慧農業、物聯網應用等。",
                    autonomous_topic: "選擇一個需要動手實作的自主學習主題，例如學習木工、電子焊接或開發一個小型應用程式。",
                    autonomous_process: "描述你如何規劃實作專案，例如收集材料、繪製草圖、動手組裝、測試與修正。",
                    autonomous_improvement: "想深化的主題或技巧是？例如學習更複雜的軟體操作、精進手工藝技巧或掌握新的實驗方法。",
                    works_projects_content_area: "具體描述你的作品內容或專題報告成果，並強調其中的實作環節和創新點。",
                    works_projects_process: "說明你從構思到完成作品或專題的完整歷程，包括設計、動手製作、測試、修改等。",
                    works_projects_improvement: "下一個想探索的主題是？思考如何將實作能力應用到更複雜或更具挑戰性的專案中。"
                },
                sophomorePlan: {
                    sophomore_strengthen: "找出在高一實作經驗中發現的不足，並規劃具體的補強計畫，例如提升工具操作技能或程式編程能力。",
                    sophomore_new_plan: "規劃參與更多實作性強的自主學習或專案，例如參加創客社、程式設計工作坊或實驗室研究。",
                    sophomore_extracurricular: "參與能夠提供實作機會的社團或活動，例如科學研究社、機器人社、工藝社等。",
                },
                universityPlan: {
                    future_departments: "探索與實作相關的科系，如工程、設計、醫學技術、資工、藝術創作等，列出你感興趣的專業。",
                    department_enhancements: "思考如何透過專題製作、實習經驗、技能檢定或參與工作坊來強化你在申請這些科系上的實作能力。",
                },
                conclusion: {
                    conclusion_reflection_1: "反思你如何透過動手實作，更深入地理解知識，並從中獲得解決問題的樂趣與成就感。",
                    conclusion_reflection_2: "期望在高二能將所學知識應用於更多實際問題，透過不斷的動手實作來提升專業技能，並創作出更多有價值的作品。"
                }
            },
            "創作思考型": {
                general: "你擁有獨特的創意和想法，高二可以多嘗試各種形式的創作，如寫作、繪畫、影音製作、程式設計等，並思考如何將這些成果與你未來想探索的領域連結。",
                personalInfo: {
                    goal_effort: "描述你為完成一個創意作品（如寫作、繪畫、程式設計、活動策劃）所付出的時間與努力。",
                    achievement: "分享你在創作過程中，哪一刻讓你最有成就感，例如一個想法被實現，或作品獲得認可。",
                    evidence: "提供你創作成果的具體證明，如作品集、手稿、設計圖、程式碼、策劃書或活動照片等。",
                    suitable_field: "思考哪個創作經驗讓你覺得特別投入和有興趣，這可能是適合你未來發展的領域。"
                },
                learningInventory: {
                    academic_achievements: "在學科學習中，是否有透過創意方式表達理解的經驗？例如用漫畫呈現歷史，或用程式模擬數學概念。",
                    academic_process: "說明你如何將學科知識轉化為創意輸出，例如撰寫獨特的報告、設計概念模型。",
                    academic_improvement: "在學科學習中，哪些部分可以透過創意方式來補強或深化？例如為某個理論設計一個應用程式。",
                    interdisciplinary_achievements: "參與過哪些需要創意發想的跨領域活動，例如設計思考工作坊、文創商品開發、媒體製作等。",
                    interdisciplinary_process: "描述你在跨領域創意活動中的發想、設計、執行過程，以及如何將不同領域的元素融合。",
                    interdisciplinary_improvement: "思考未來想嘗試哪些結合創意的跨領域學習，例如數位藝術、遊戲設計、文化內容創作等。",
                    autonomous_topic: "選擇一個能發揮你創意思考的自主學習主題，例如創作一部小說、設計一個網頁、開發一個小遊戲。",
                    autonomous_process: "描述你如何從靈感發想、概念設計、逐步執行到完成創作的過程，並記錄遇到的挑戰與解決方案。",
                    autonomous_improvement: "想深化的主題或技巧是？例如學習新的創作軟體、提升美學素養或加強故事敘述能力。",
                    works_projects_content_area: "具體描述你的創意作品或專題報告內容，並強調其中的創新點和獨特性。",
                    works_projects_process: "說明你從構思到完成作品或專題的完整歷程，包括發想、設計、製作、展示等，並分享你的設計理念。",
                    works_projects_improvement: "下一個想探索的主題是？思考如何將創意應用到更廣泛的領域，或提升作品的影響力。"
                },
                sophomorePlan: {
                    sophomore_strengthen: "找出在高一創作經驗中發現的不足，並規劃具體的補強計畫，例如學習新的創作軟體、提升批判性思維能力。",
                    sophomore_new_plan: "規劃參與更多創意性自主學習或專案，例如創作社團、獨立研究專案、設計競賽等。",
                    sophomore_extracurricular: "參與能夠激發創意思考的社團或活動，例如文藝社、辯論社、電影社、設計社等。",
                },
                universityPlan: {
                    future_departments: "探索與創意相關的科系，如設計、藝術、建築、傳播、文學、數位媒體、遊戲設計等，列出你感興趣的專業。",
                    department_enhancements: "思考如何透過作品集、創意專案、設計競賽或參與相關工作坊來強化你在申請這些科系上的創意能力。",
                },
                conclusion: {
                    conclusion_reflection_1: "反思你如何透過創作，更深入地理解自我，並從中獲得表達想法、解決問題的樂趣與成就感。",
                    conclusion_reflection_2: "期望在高二能持續探索和發展你的創意潛能，創作出更多獨特且有意義的作品，並將創意融入未來的學習與生活中。"
                }
            },
            "尚未明確型": {
                general: "這很正常！高二是一個探索的好時機。建議你多參加講座、閱讀不同領域的書籍，並嘗試不同的學習活動，幫助自己找到方向。",
                personalInfo: {
                    goal_effort: "回想是否有任何讓你感到好奇或曾短暫投入過的事，即使只是為了了解新知。",
                    achievement: "思考在學習或生活中，是否有任何讓你感到「原來如此」或「有點意思」的時刻。",
                    evidence: "記錄你曾經嘗試過的不同活動，即使是簡單的參與，也是一種探索的證據。",
                    suitable_field: "描述某個經驗讓你對某個領域產生了初步的好奇心，即使還不確定是否適合。"
                },
                learningInventory: {
                    academic_achievements: "在學科學習中，哪些科目讓你覺得相對容易理解或內容比較有趣？",
                    academic_process: "描述你在各科學習中嘗試過的方法，並思考哪種方法對你來說效果比較好。",
                    academic_improvement: "嘗試找出你覺得最不排斥或甚至有點好奇的學科，並規劃一點點的探索。",
                    interdisciplinary_achievements: "參與過哪些不同主題的講座或活動？即使只是旁聽，也請記錄下任何吸引你的部分。",
                    interdisciplinary_process: "描述你參與這些活動後，是否有任何新的想法或好奇點產生。",
                    interdisciplinary_improvement: "未來想嘗試哪種類型的跨領域活動，例如科學、藝術、社會議題等，可以多方接觸。",
                    autonomous_topic: "選擇一個你純粹好奇的主題，不論其是否有實用性，例如看一部紀錄片、學習一個簡單的樂器。",
                    autonomous_process: "描述你如何開始探索一個新主題，例如從網路搜尋、閱讀入門書籍、觀看教學影片。",
                    autonomous_improvement: "想深化的主題或技巧是？思考你是否想對某個新事物進行更深入的了解。",
                    lectures_forums_activities: "記錄你參與過的任何講座或論壇，不論主題，只需描述它們如何引起你的注意。",
                    lectures_forums_reflection: "從這些講座中，是否有任何知識點或觀點讓你產生疑問或好奇？",
                    lectures_improvement: "未來想聽哪方面的講座？思考不同學群的講座，可以擴展你的視野。",
                    volunteer_experience: "是否有參與過任何志工或服務性質的活動？即使是校內服務也算。",
                    volunteer_reflection: "你在服務過程中，是否有觀察到任何社會現象或個人成長？",
                    volunteer_improvement: "想規劃或延續哪些服務？思考你是否想在特定領域貢獻力量。",
                    club_role: "你在社團或班級中是否有參與任何活動？說明你的參與方式。",
                    club_leadership_process: "在社團中是否有接觸到不同的人，或解決小問題的經驗？",
                    club_leadership_improvement: "思考在高二是否想嘗試參與一個你從未接觸過的社團，擴大交友圈和視野。",
                },
                sophomorePlan: {
                    sophomore_strengthen: "找出你覺得相對弱勢但又必須面對的科目，並規劃基本的補強措施。",
                    sophomore_new_plan: "嘗試規劃參與至少一項你從未做過的自主學習或活動，例如閱讀一本非教科書的書。",
                    sophomore_extracurricular: "選擇一兩個你感到好奇或能輕鬆參與的社團或課外活動，先嘗試再說。",
                },
                universityPlan: {
                    future_departments: "列出目前已知的一些大學科系類型，例如「商管」、「資訊」、「醫學」等，不需精準，僅供參考。",
                    department_enhancements: "思考哪些通識課程或基礎能力（如語文、表達）是大多數科系都需要的，並規劃提升。",
                },
                conclusion: {
                    conclusion_reflection_1: "反思你如何透過報告，更清楚地意識到自己仍在探索階段，並學會接受這種不確定性。",
                    conclusion_reflection_2: "期望在高二能更積極地參與各類活動，多方嘗試，找到真正吸引自己的興趣與潛能，讓方向逐漸明朗。"
                }
            }
            // 可以繼續擴展其他學習者類型
        };

        // 頁面載入完成後執行初始化
        document.addEventListener('DOMContentLoaded', () => {
            populateAcademicClusters(); // 填充學群下拉選單和多選框
            setupEventListeners(); // 設定事件監聽器
            loadReport(); // 嘗試載入上次儲存的報告 (會呼叫 updatePrompts)
            // updatePrompts(); // 初始化智能引導提示 (已在 loadReport 中包含)
        });

        /**
         * 根據選擇的學習者類型更新提示內容，並應用到各輸入框的placeholder
         */
        function updatePrompts() {
            const learnerType = document.getElementById("learnerType").value;
            const promptDiv = document.getElementById("promptTips");

            // 更新頂部總體提示
            if (learnerType && guidanceDetails[learnerType]) {
                promptDiv.textContent = guidanceDetails[learnerType].general || "選擇你的學習者類型，這裡會給你一些撰寫提示喔！";
            } else {
                promptDiv.textContent = "選擇你的學習者類型，這裡會給你一些撰寫提示喔！";
            }

            // 應用更細緻的區塊提示
            applySectionGuidance(learnerType);
        }

        /**
         * 根據學習者類型，更新各個輸入框的placeholder提示
         * @param {string} learnerType 當前選擇的學習者類型
         */
        function applySectionGuidance(learnerType) {
            const defaultPlaceholders = {
                goal_effort: "請描述您的目標與努力過程",
                achievement: "請描述您的成就感經驗",
                evidence: "例如: 筆記、影片、照片、心得、比賽、專題、閱讀等",
                suitable_field: "請描述您的經驗",

                academic_achievements: "例: 參加學科競賽、段考成績優良、修習額外課程",
                academic_process: "例: 學習筆記、課程筆記",
                academic_improvement: "例: 準備物理競賽、補強英文表達、修習新課程",
                interdisciplinary_achievements: "例: 科普講座、跨域專題、AI體驗營",
                interdisciplinary_process: "請描述您的紀錄與心得",
                interdisciplinary_improvement: "想嘗試的跨域學習是?",
                competition_achievements: "例: 語文競賽、科展、數理競賽",
                competition_process: "獲獎經驗與準備過程",
                competition_improvement: "準備中的競賽或目標",
                autonomous_topic: "例: 線上課程、撰寫小論文、寫研究報告",
                autonomous_process: "我如何規劃與紀錄?",
                autonomous_improvement: "想深化的主題或技巧是?",
                lectures_forums_activities: "例: 參與科普演講、學校講座、線上論壇",
                lectures_forums_reflection: "最印象深刻的觀點是?",
                lectures_forums_improvement: "未來想聽哪方面的講座?",
                volunteer_experience: "例: 偏鄉服務、校內志工、環境清潔活動",
                volunteer_reflection: "這些經驗帶給我什麼學習與影響?",
                volunteer_improvement: "想規劃或延續哪些服務?",
                club_role: "例: 班級幹部、社團幹部、活動主持、籌備營隊",
                club_leadership_process: "最具挑戰的經驗與收穫?",
                club_leadership_improvement: "想嘗試的新角色或能力是?",
                works_projects_content_area: "例: 發表創作、完成專題、參與科展",
                works_projects_process: "我如何規劃與呈現成果?",
                works_projects_improvement: "下一個想探索的主題是?",
                future_interest_area: "例: 生物醫學、機器學習、設計思維等",
                future_improvement_needed: "請描述需要加強的方面",
                future_plan: "我打算如何朝這個方向前進?",
                sophomore_strengthen: "請描述您需要加強的部分",
                sophomore_new_plan: "請描述新增的計畫",
                sophomore_extracurricular: "請描述預計參與的活動",
                future_departments: "請輸入您未來可能選擇的科系",
                department_enhancements: "請描述所需的補強項目",
                conclusion_reflection_1: "請填寫您的反思",
                conclusion_reflection_2: "請填寫您的期望"
            };

            const allTextAreas = document.querySelectorAll('textarea, input[type="text"]');

            allTextAreas.forEach(element => {
                const id = element.id;
                let newPlaceholder = defaultPlaceholders[id] || ""; // 預設為通用提示

                if (learnerType && guidanceDetails[learnerType]) {
                    const sectionGuidance = guidanceDetails[learnerType];
                    // 檢查各區塊是否有針對該ID的特定提示
                    if (sectionGuidance.personalInfo && sectionGuidance.personalInfo[id]) {
                        newPlaceholder = sectionGuidance.personalInfo[id];
                    } else if (sectionGuidance.learningInventory && sectionGuidance.learningInventory[id]) {
                        newPlaceholder = sectionGuidance.learningInventory[id];
                    } else if (sectionGuidance.sophomorePlan && sectionGuidance.sophomorePlan[id]) {
                        newPlaceholder = sectionGuidance.sophomorePlan[id];
                    } else if (sectionGuidance.universityPlan && sectionGuidance.universityPlan[id]) {
                        newPlaceholder = sectionGuidance.universityPlan[id];
                    } else if (sectionGuidance.conclusion && sectionGuidance.conclusion[id]) {
                        newPlaceholder = sectionGuidance.conclusion[id];
                    }
                }
                // 只在當前值為空時更新placeholder，避免覆蓋已填寫的內容
                if (!element.value) {
                    element.placeholder = newPlaceholder;
                } else {
                    // 如果有內容，確保placeholder不會顯示引導，可以顯示一個更簡潔的
                    element.placeholder = defaultPlaceholders[id] || "";
                }
            });
        }


        /**
         * 填充所有學群下拉選單和升學方向規劃中的學群多選框
         */
        function populateAcademicClusters() {
            const selectElements = document.querySelectorAll('select[id$="_cluster"]');
            selectElements.forEach(select => {
                // 確保每個select只添加一次option
                if (select.options.length === 1 && select.options[0].value === "") { // 檢查是否只有預設的空選項
                    academicClusters.forEach(cluster => {
                        const option = document.createElement('option');
                        option.value = cluster.name;
                        option.textContent = cluster.name;
                        select.appendChild(option);
                    });
                }
            });

            const clusterSelectionCheckboxes = document.getElementById('cluster_selection_checkboxes');
            // 避免重複添加checkboxes
            if (clusterSelectionCheckboxes && clusterSelectionCheckboxes.children.length === 0) {
                academicClusters.forEach(cluster => {
                    const label = document.createElement('label');
                    label.className = 'inline-flex items-center';
                    label.innerHTML = `
                        <input type="checkbox" name="selected_clusters" value="${cluster.name}" class="form-checkbox text-blue-600">
                        <span class="ml-2 text-gray-700">${cluster.name}</span>
                    `;
                    clusterSelectionCheckboxes.appendChild(label);
                });
            }
        }


        /**
         * 設定所有事件監聽器
         */
        function setupEventListeners() {
            document.getElementById('saveButton').addEventListener('click', saveReport);
            document.getElementById('loadButton').addEventListener('click', loadReport);
            document.getElementById('clearButton').addEventListener('click', clearReport);
            document.getElementById('generateCareerSuggestionsButton').addEventListener('click', generateCareerSuggestions);


            // 監聽「其他」目標多選框的變化，以啟用/禁用相關文字輸入框
            const sophomoreGoalsOtherCheckbox = document.getElementById('sophomore_goals_other_checkbox');
            const sophomoreGoalsOtherText = document.getElementById('sophomore_goals_other_text');
            if (sophomoreGoalsOtherCheckbox && sophomoreGoalsOtherText) {
                sophomoreGoalsOtherCheckbox.addEventListener('change', () => {
                    sophomoreGoalsOtherText.disabled = !sophomoreGoalsOtherCheckbox.checked;
                    if (!sophomoreGoalsOtherCheckbox.checked) {
                        sophomoreGoalsOtherText.value = ''; // 清空內容如果禁用
                    }
                });
            }
        }

        /**
         * 顯示訊息提示框
         * @param {string} message 要顯示的訊息
         * @param {string} type 訊息類型 (success, error, info)
         */
        function showMessage(message, type = 'info') {
            const messageBox = document.getElementById('messageBox');
            const messageText = document.getElementById('messageText');

            messageText.textContent = message;
            messageBox.classList.remove('hidden', 'bg-green-600', 'bg-red-600', 'bg-gray-800');
            messageBox.classList.add('block');

            // 根據類型設定背景顏色
            if (type === 'success') {
                messageBox.classList.add('bg-green-600');
            } else if (type === 'error') {
                messageBox.classList.add('bg-red-600');
            } else {
                messageBox.classList.add('bg-gray-800');
            }

            // 訊息自動消失
            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, 3000);
        }

        /**
         * 儲存報告內容到 localStorage
         */
        function saveReport() {
            const reportData = {};
            // 遍歷所有輸入元素並儲存其值
            document.querySelectorAll('input, textarea, select').forEach(element => {
                if (element.type === 'radio') {
                    if (element.checked) {
                        reportData[element.name] = element.value;
                    }
                } else if (element.type === 'checkbox') {
                    if (!reportData[element.name]) {
                        reportData[element.name] = [];
                    }
                    if (element.checked) {
                        reportData[element.name].push(element.value);
                    }
                } else {
                    reportData[element.id] = element.value;
                }
            });

            // 特殊處理「其他」目標的文字框
            const sophomoreGoalsOtherCheckbox = document.getElementById('sophomore_goals_other_checkbox');
            const sophomoreGoalsOtherText = document.getElementById('sophomore_goals_other_text');
            if (sophomoreGoalsOtherCheckbox && sophomoreGoalsOtherText && sophomoreGoalsOtherCheckbox.checked) {
                if (!reportData['sophomore_goals']) {
                    reportData['sophomore_goals'] = [];
                }
                reportData['sophomore_goals'].push(`其他: ${sophomoreGoalsOtherText.value}`);
            }

            try {
                localStorage.setItem('careerPlanningReport', JSON.stringify(reportData));
                showMessage('報告已成功儲存！', 'success');
            } catch (e) {
                showMessage('儲存報告失敗，可能儲存空間不足。', 'error');
                console.error("Error saving to localStorage:", e);
            }
        }

        /**
         * 從 localStorage 載入報告內容
         */
        function loadReport() {
            try {
                const savedData = localStorage.getItem('careerPlanningReport');
                if (savedData) {
                    const reportData = JSON.parse(savedData);
                    // 遍歷儲存的資料並填充到對應的輸入元素
                    for (const id in reportData) {
                        const element = document.getElementById(id);
                        if (element) {
                            if (element.type === 'textarea' || element.type === 'text' || element.type === 'select-one') {
                                element.value = reportData[id];
                            }
                        } else {
                            // 處理 radio 和 checkbox (它們沒有單獨的 ID)
                            const elementsByName = document.querySelectorAll(`[name="${id}"]`);
                            if (elementsByName.length > 0) {
                                elementsByName.forEach(el => {
                                    if (el.type === 'radio') {
                                        if (el.value === reportData[id]) {
                                            el.checked = true;
                                        }
                                    } else if (el.type === 'checkbox') {
                                        if (Array.isArray(reportData[id]) && reportData[id].includes(el.value)) {
                                            el.checked = true;
                                        }
                                    }
                                });
                            }
                        }
                    }

                    // 特殊處理「其他」目標的文字框
                    const sophomoreGoalsOtherCheckbox = document.getElementById('sophomore_goals_other_checkbox');
                    const sophomoreGoalsOtherText = document.getElementById('sophomore_goals_other_text');
                    if (sophomoreGoalsOtherCheckbox && sophomoreGoalsOtherText) {
                        const sophomoreGoals = reportData['sophomore_goals'] || [];
                        const otherGoal = sophomoreGoals.find(goal => goal.startsWith('其他: '));
                        if (otherGoal) {
                            sophomoreGoalsOtherCheckbox.checked = true;
                            sophomoreGoalsOtherText.value = otherGoal.replace('其他: ', '');
                            sophomoreGoalsOtherText.disabled = false;
                        } else {
                            sophomoreGoalsOtherCheckbox.checked = false;
                            sophomoreGoalsOtherText.value = '';
                            sophomoreGoalsOtherText.disabled = true;
                        }
                    }

                    updatePrompts(); // 載入資料後，更新智能引導提示和各輸入框的placeholder
                    showMessage('報告已成功載入！', 'success');
                } else {
                    showMessage('沒有找到已儲存的報告。', 'info');
                }
            } catch (e) {
                showMessage('載入報告失敗，資料可能已損壞。', 'error');
                console.error("Error loading from localStorage:", e);
            }
        }

        /**
         * 清除所有報告內容
         */
        function clearReport() {
            // 清空所有輸入元素
            document.querySelectorAll('input, textarea, select').forEach(element => {
                if (element.type === 'radio' || element.type === 'checkbox') {
                    element.checked = false;
                } else if (element.tagName === 'SELECT') {
                    element.value = ''; // 將選單重置為第一個選項（通常是空選項）
                } else {
                    element.value = '';
                }
            });

            // 禁用「其他」目標的文字框
            const sophomoreGoalsOtherText = document.getElementById('sophomore_goals_other_text');
            if (sophomoreGoalsOtherText) {
                sophomoreGoalsOtherText.disabled = true;
            }

            // 清除 localStorage 中的資料
            localStorage.removeItem('careerPlanningReport');
            updatePrompts(); // 清除後，更新智能引導提示為預設狀態並重置所有placeholder
            showMessage('所有報告內容已清除！', 'info');
        }

        /**
         * 切換區塊的顯示/隱藏狀態
         * @param {string} contentId 要切換的區塊 ID
         */
        function toggleSection(contentId) {
            const content = document.getElementById(contentId);
            if (content) {
                content.classList.toggle('hidden');
            }
        }

        /**
         * 使用 Gemini API 生成職涯發展建議
         */
        async function generateCareerSuggestions() {
            const name = document.getElementById('name').value;
            const futureInterestArea = document.getElementById('future_interest_area').value;
            const futurePlan = document.getElementById('future_plan').value;
            const futureDepartments = document.getElementById('future_departments').value;

            const selectedClustersCheckboxes = document.querySelectorAll('input[name="selected_clusters"]:checked');
            const selectedClusters = Array.from(selectedClustersCheckboxes).map(cb => cb.value);

            const outputDiv = document.getElementById('careerSuggestionsOutput');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const generateButton = document.getElementById('generateCareerSuggestionsButton');

            // 檢查必要欄位是否填寫
            if (!futureInterestArea && !futurePlan && selectedClusters.length === 0 && !futureDepartments) {
                showMessage('請至少填寫「未來學習目標」或「升學方向規劃」中的部分資訊，以便生成建議。', 'info');
                return;
            }

            outputDiv.textContent = ''; // 清空之前的內容
            loadingIndicator.classList.remove('hidden'); // 顯示載入指示器
            generateButton.disabled = true; // 禁用按鈕

            let chatHistory = [];
            const prompt = `作為一位經驗豐富的生涯規劃顧問，請根據以下學生的資訊，提供具體且個人化的職涯發展建議和相關科系或學習方向的建議。請以條列式呈現，並提供至少3-5個建議。

學生姓名: ${name || '未提供'}
目前興趣領域: ${futureInterestArea || '未填寫'}
下一步學習規劃: ${futurePlan || '未填寫'}
已選擇的學群: ${selectedClusters.length > 0 ? selectedClusters.join('、') : '未選擇'}
未來可能選擇的科系: ${futureDepartments || '未填寫'}

請根據這些資訊，提供專業且個人化的建議。`;

            chatHistory.push({ role: "user", parts: [{ text: prompt }] });
            const payload = { contents: chatHistory };
            const apiKey = ""; // 如果您想使用 gemini-2.0-flash 或 imagen-3.0-generate-002 以外的模型，請在此處提供 API 金鑰。否則，請保持原樣。
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    outputDiv.textContent = text; // 顯示生成的建議
                    showMessage('職涯發展建議已生成！', 'success');
                } else {
                    outputDiv.textContent = '未能生成建議。請檢查您的輸入或稍後再試。';
                    showMessage('生成建議失敗。', 'error');
                    console.error("Gemini API response structure unexpected:", result);
                }
            } catch (error) {
                outputDiv.textContent = '生成建議時發生錯誤。請檢查網路連線或稍後再試。';
                showMessage('生成建議時發生錯誤。', 'error');
                console.error("Error calling Gemini API:", error);
            } finally {
                loadingIndicator.classList.add('hidden'); // 隱藏載入指示器
                generateButton.disabled = false; // 啟用按鈕
            }
        }
    
function downloadReportAsTXT() {
    let content = "【生涯規劃報告填寫結果】\n\n";
    const elements = document.querySelectorAll("input, textarea, select");
    elements.forEach(el => {
        if (!el.name && !el.id) return;

        const label = el.closest("div")?.querySelector("label")?.innerText || el.name || el.id;
        let value = "";

        if (el.type === "radio" || el.type === "checkbox") {
            if (el.checked) {
                value = el.value;
            } else {
                return;
            }
        } else if (el.tagName === "SELECT" && el.multiple) {
            value = Array.from(el.selectedOptions).map(opt => opt.value).join(", ");
        } else {
            value = el.value;
        }

        if (value) {
            content += `【${label}】\n${value}\n\n`;
        }
    });

    const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "生涯規劃報告.txt";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
}

</script>
</body>
</html>
